2026-01-22 00:05:50.357 + setup_drives
2026-01-22 00:05:50.359 + local idx=0
2026-01-22 00:05:50.361 + tee -a /dev/console
2026-01-22 00:05:50.362 ++ date
2026-01-22 00:05:50.365 + echo 'Drives setup started at: Thu' Jan 22 00:05:50 UTC 2026
2026-01-22 00:05:50.366 Drives setup started at: Thu Jan 22 00:05:50 UTC 2026
2026-01-22 00:05:50.368 + set -xe
2026-01-22 00:05:50.369 ++ find /usr/share/aws/emr/instance-controller/lib -name 'instance-controller*.jar' -and -not -name '*interface*'
2026-01-22 00:05:50.381 + local instance_controller_jar=/usr/share/aws/emr/instance-controller/lib/instance-controller-1.85.0.jar
2026-01-22 00:05:50.382 + '[' -e /var/setup-devices/device-names.json ']'
2026-01-22 00:05:50.383 ++ lsblk -pdno NAME
2026-01-22 00:05:50.385 ++ sort -V
2026-01-22 00:05:50.387 + local 'block_devices=/dev/nvme0n1
2026-01-22 00:05:50.388 /dev/nvme1n1
2026-01-22 00:05:50.389 /dev/nvme2n1'
2026-01-22 00:05:50.391 ++ cat /var/setup-devices/device-names.json
2026-01-22 00:05:50.392 ++ jq -r '.symlinkDevices | keys[]'
2026-01-22 00:05:50.394 ++ tr '\n' ' '
2026-01-22 00:05:50.405 + symlink_devices=('/dev/nvme0n1' '/dev/nvme2n1')
2026-01-22 00:05:50.406 + local symlink_devices
2026-01-22 00:05:50.407 ++ jq -r '.deviceNameRegex[]'
2026-01-22 00:05:50.409 ++ paste -s -d '|'
2026-01-22 00:05:50.420 + active_device_pattern='/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-22 00:05:50.421 + for symlink_device in ${symlink_devices[*]}
2026-01-22 00:05:50.423 ++ cat /var/setup-devices/device-names.json
2026-01-22 00:05:50.425 ++ jq -r '.symlinkDevices."/dev/nvme0n1"'
2026-01-22 00:05:50.426 + link_to_device=('/dev/xvda')
2026-01-22 00:05:50.427 + local link_to_device
2026-01-22 00:05:50.428 + symlink_root_device /dev/xvda /dev/nvme0n1
2026-01-22 00:05:50.430 + local root_device=/dev/xvda
2026-01-22 00:05:50.431 + local other_device=/dev/nvme0n1
2026-01-22 00:05:50.432 + '[' '!' -e /dev/xvda ']'
2026-01-22 00:05:50.434 + for symlink_device in ${symlink_devices[*]}
2026-01-22 00:05:50.435 ++ cat /var/setup-devices/device-names.json
2026-01-22 00:05:50.436 ++ jq -r '.symlinkDevices."/dev/nvme0n1"'
2026-01-22 00:05:50.438 + link_to_device=('/dev/xvda')
2026-01-22 00:05:50.439 + local link_to_device
2026-01-22 00:05:50.440 + symlink_root_device /dev/xvda /dev/nvme2n1
2026-01-22 00:05:50.442 + local root_device=/dev/xvda
2026-01-22 00:05:50.443 + local other_device=/dev/nvme2n1
2026-01-22 00:05:50.444 + '[' '!' -e /dev/xvda ']'
2026-01-22 00:05:50.446 + [[ ! -e /var/setup-devices/completed ]]
2026-01-22 00:05:50.447 + setup_cloud_cfg
2026-01-22 00:05:50.449 + cat
2026-01-22 00:05:50.450 + mv /tmp/00_emr.cfg /etc/cloud/cloud.cfg.d/
2026-01-22 00:05:50.452 
2026-01-22 00:05:50.453 real	0m0.005s
2026-01-22 00:05:50.454 user	0m0.003s
2026-01-22 00:05:50.456 sys	0m0.000s
2026-01-22 00:05:50.457 ++ ls /media/
2026-01-22 00:05:50.459 + active_devices=()
2026-01-22 00:05:50.460 + for device in $block_devices
2026-01-22 00:05:50.461 + is_swap_device /dev/nvme0n1
2026-01-22 00:05:50.463 + local device=/dev/nvme0n1
2026-01-22 00:05:50.464 + local return_code=0
2026-01-22 00:05:50.466 + swapon -s
2026-01-22 00:05:50.467 + grep -w /dev/nvme0n1
2026-01-22 00:05:50.468 + return_code=1
2026-01-22 00:05:50.469 + return 1
2026-01-22 00:05:50.470 ++ is_active_device /dev/nvme0n1
2026-01-22 00:05:50.472 ++ local device=/dev/nvme0n1
2026-01-22 00:05:50.473 ++ matches_active_device_pattern /dev/nvme0n1
2026-01-22 00:05:50.474 ++ local device=/dev/nvme0n1
2026-01-22 00:05:50.476 ++ echo /dev/nvme0n1
2026-01-22 00:05:50.477 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-22 00:05:50.478 ++ od -N 0 /dev/nvme0n1
2026-01-22 00:05:50.479 ++ '[' 0 == 0 ']'
2026-01-22 00:05:50.481 ++ echo true
2026-01-22 00:05:50.482 + '[' true '!=' true ']'
2026-01-22 00:05:50.483 ++ is_link_from_root_device /dev/xvda /dev/nvme0n1
2026-01-22 00:05:50.485 +++ readlink -f /dev/xvda
2026-01-22 00:05:50.486 ++ local root_device=/dev/nvme0n1
2026-01-22 00:05:50.487 ++ local this_device=/dev/nvme0n1
2026-01-22 00:05:50.488 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\0\n\1 ]]
2026-01-22 00:05:50.489 ++ echo true
2026-01-22 00:05:50.491 + '[' true == true ']'
2026-01-22 00:05:50.492 + continue
2026-01-22 00:05:50.493 + for device in $block_devices
2026-01-22 00:05:50.495 + is_swap_device /dev/nvme1n1
2026-01-22 00:05:50.496 + local device=/dev/nvme1n1
2026-01-22 00:05:50.497 + local return_code=0
2026-01-22 00:05:50.498 + swapon -s
2026-01-22 00:05:50.500 + grep -w /dev/nvme1n1
2026-01-22 00:05:50.501 + return_code=1
2026-01-22 00:05:50.502 + return 1
2026-01-22 00:05:50.503 ++ is_active_device /dev/nvme1n1
2026-01-22 00:05:50.505 ++ local device=/dev/nvme1n1
2026-01-22 00:05:50.506 ++ matches_active_device_pattern /dev/nvme1n1
2026-01-22 00:05:50.507 ++ local device=/dev/nvme1n1
2026-01-22 00:05:50.508 ++ echo /dev/nvme1n1
2026-01-22 00:05:50.510 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-22 00:05:50.512 ++ od -N 0 /dev/nvme1n1
2026-01-22 00:05:50.513 ++ '[' 0 == 0 ']'
2026-01-22 00:05:50.515 ++ echo true
2026-01-22 00:05:50.521 + '[' true '!=' true ']'
2026-01-22 00:05:50.523 ++ is_link_from_root_device /dev/xvda /dev/nvme1n1
2026-01-22 00:05:50.525 +++ readlink -f /dev/xvda
2026-01-22 00:05:50.526 ++ local root_device=/dev/nvme0n1
2026-01-22 00:05:50.528 ++ local this_device=/dev/nvme1n1
2026-01-22 00:05:50.529 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\1\n\1 ]]
2026-01-22 00:05:50.530 + '[' '' == true ']'
2026-01-22 00:05:50.532 + umount -f /dev/nvme1n1
2026-01-22 00:05:50.533 umount: /dev/nvme1n1: not mounted.
2026-01-22 00:05:50.535 + true
2026-01-22 00:05:50.536 + remove_fstab_entry /dev/nvme1n1
2026-01-22 00:05:50.537 + local deviceIdentifier=/dev/nvme1n1
2026-01-22 00:05:50.539 + grep -v /dev/nvme1n1 /etc/fstab
2026-01-22 00:05:50.540 + mv /tmp/fstab /etc/fstab
2026-01-22 00:05:50.541 + '[' 0 == 0 ']'
2026-01-22 00:05:50.543 + sgdisk -o -n 1:0:+5GB -N2 -p /dev/nvme1n1
2026-01-22 00:05:51.532 Creating new GPT entries in memory.
2026-01-22 00:05:51.533 Disk /dev/nvme1n1: 67108864 sectors, 32.0 GiB
2026-01-22 00:05:51.535 Model: Amazon Elastic Block Store              
2026-01-22 00:05:51.537 Sector size (logical/physical): 512/512 bytes
2026-01-22 00:05:51.538 Disk identifier (GUID): 1266BBEE-2590-426A-8EA8-E9651C8FDAA0
2026-01-22 00:05:51.539 Partition table holds up to 128 entries
2026-01-22 00:05:51.541 Main partition table begins at sector 2 and ends at sector 33
2026-01-22 00:05:51.542 First usable sector is 34, last usable sector is 67108830
2026-01-22 00:05:51.543 Partitions will be aligned on 2048-sector boundaries
2026-01-22 00:05:51.545 Total free space is 2014 sectors (1007.0 KiB)
2026-01-22 00:05:51.546 
2026-01-22 00:05:51.547 Number  Start (sector)    End (sector)  Size       Code  Name
2026-01-22 00:05:51.549    1            2048        10487807   5.0 GiB     8300  
2026-01-22 00:05:51.550    2        10487808        67108830   27.0 GiB    8300  
2026-01-22 00:05:51.551 The operation has completed successfully.
2026-01-22 00:05:51.552 + active_devices=($(ls -1 $device?*))
2026-01-22 00:05:51.554 ++ ls -1 /dev/nvme1n1p1 /dev/nvme1n1p2
2026-01-22 00:05:51.555 + (( idx = idx + 1 ))
2026-01-22 00:05:51.556 + for device in $block_devices
2026-01-22 00:05:51.557 + is_swap_device /dev/nvme2n1
2026-01-22 00:05:51.559 + local device=/dev/nvme2n1
2026-01-22 00:05:51.560 + local return_code=0
2026-01-22 00:05:51.561 + swapon -s
2026-01-22 00:05:51.562 + grep -w /dev/nvme2n1
2026-01-22 00:05:51.564 + return_code=1
2026-01-22 00:05:51.565 + return 1
2026-01-22 00:05:51.566 ++ is_active_device /dev/nvme2n1
2026-01-22 00:05:51.567 ++ local device=/dev/nvme2n1
2026-01-22 00:05:51.569 ++ matches_active_device_pattern /dev/nvme2n1
2026-01-22 00:05:51.570 ++ local device=/dev/nvme2n1
2026-01-22 00:05:51.571 ++ echo /dev/nvme2n1
2026-01-22 00:05:51.572 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-22 00:05:51.574 ++ od -N 0 /dev/nvme2n1
2026-01-22 00:05:51.575 ++ '[' 0 == 0 ']'
2026-01-22 00:05:51.576 ++ echo true
2026-01-22 00:05:51.577 + '[' true '!=' true ']'
2026-01-22 00:05:51.579 ++ is_link_from_root_device /dev/xvda /dev/nvme2n1
2026-01-22 00:05:51.580 +++ readlink -f /dev/xvda
2026-01-22 00:05:51.581 ++ local root_device=/dev/nvme0n1
2026-01-22 00:05:51.582 ++ local this_device=/dev/nvme2n1
2026-01-22 00:05:51.584 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\2\n\1 ]]
2026-01-22 00:05:51.585 + '[' '' == true ']'
2026-01-22 00:05:51.586 + umount -f /dev/nvme2n1
2026-01-22 00:05:51.588 umount: /dev/nvme2n1: not mounted.
2026-01-22 00:05:51.589 + true
2026-01-22 00:05:51.590 + remove_fstab_entry /dev/nvme2n1
2026-01-22 00:05:51.593 + local deviceIdentifier=/dev/nvme2n1
2026-01-22 00:05:51.594 + grep -v /dev/nvme2n1 /etc/fstab
2026-01-22 00:05:51.595 + mv /tmp/fstab /etc/fstab
2026-01-22 00:05:51.596 + '[' 1 == 0 ']'
2026-01-22 00:05:51.597 + active_devices+=($device)
2026-01-22 00:05:51.599 + (( idx = idx + 1 ))
2026-01-22 00:05:51.600 + encrypted_devices=($($INSTANCE_CONTROLLER_JAVA/java -cp $DISK_ENCRYPTOR_CP -Dlog4j2.configurationFile=file:$DISK_ENCRYPTOR_LOG4J2_CONFIG -Dlog4j2.formatMsgNoLookups=true -Dlog4j2.disable.jmx=true aws157.instancecontroller.encryptor.DiskEncryptorMain ${active_devices[*]}))
2026-01-22 00:05:51.602 ++ /usr/lib/jvm/jre-17/bin/java -cp '/usr/share/aws/emr/instance-controller/lib/*:/var/setup-devices/lib/*:/home/hadoop/conf:/usr/share/aws/aws-java-sdk-v2/*' -Dlog4j2.configurationFile=file:/etc/instance-controller/disk-encryptor-log4j2.xml -Dlog4j2.formatMsgNoLookups=true -Dlog4j2.disable.jmx=true aws157.instancecontroller.encryptor.DiskEncryptorMain /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-22 00:05:57.923 SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
2026-01-22 00:05:57.925 SLF4J: Defaulting to no-operation (NOP) logger implementation
2026-01-22 00:05:57.927 SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
2026-01-22 00:05:58.441 + make_xfs_parallel /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-22 00:05:58.443 ++ printf '%s\n' /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-22 00:05:58.444 + local 'devices=/dev/nvme1n1p1
2026-01-22 00:05:58.446 /dev/nvme1n1p2
2026-01-22 00:05:58.448 /dev/nvme2n1'
2026-01-22 00:05:58.449 ++ run_repeatedly 3 mktemp -t make_xfs_XXXXXXXXXX
2026-01-22 00:05:58.451 ++ (( i = 0 ))
2026-01-22 00:05:58.453 ++ (( i < 3 ))
2026-01-22 00:05:58.455 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-22 00:05:58.456 ++ (( i++ ))
2026-01-22 00:05:58.457 ++ (( i < 3 ))
2026-01-22 00:05:58.458 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-22 00:05:58.459 ++ (( i++ ))
2026-01-22 00:05:58.461 ++ (( i < 3 ))
2026-01-22 00:05:58.462 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-22 00:05:58.463 ++ (( i++ ))
2026-01-22 00:05:58.465 ++ (( i < 3 ))
2026-01-22 00:05:58.466 + local 'log_files=/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.468 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.469 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:58.470 + local return_code=0
2026-01-22 00:05:58.472 + run_make_xfs_parallel '/dev/nvme1n1p1
2026-01-22 00:05:58.473 /dev/nvme1n1p2
2026-01-22 00:05:58.474 /dev/nvme2n1' '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.475 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.477 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:58.478 + local 'devices=/dev/nvme1n1p1
2026-01-22 00:05:58.479 /dev/nvme1n1p2
2026-01-22 00:05:58.481 /dev/nvme2n1'
2026-01-22 00:05:58.482 + local 'log_files=/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.483 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.484 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:58.486 + timeout --kill-after=10 10 bash -c '{ date; udevadm monitor; }'
2026-01-22 00:05:58.487 + interleave_lines '/dev/nvme1n1p1
2026-01-22 00:05:58.488 /dev/nvme1n1p2
2026-01-22 00:05:58.490 /dev/nvme2n1' '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.491 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.492 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:58.493 + xargs -r --verbose -P0 -L2 bash -xc '
2026-01-22 00:05:58.495       device=$0; log_file=$1
2026-01-22 00:05:58.496       { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1'
2026-01-22 00:05:58.497 ++ date +%Y-%m-%d-%H-%M-%S
2026-01-22 00:05:58.498 ++ echo '/dev/nvme1n1p1
2026-01-22 00:05:58.500 /dev/nvme1n1p2
2026-01-22 00:05:58.501 /dev/nvme2n1'
2026-01-22 00:05:58.502 + paste '-d\n' /dev/fd/63 /dev/fd/62
2026-01-22 00:05:58.504 ++ echo '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.505 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.506 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:58.507 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme1n1p1 /tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.509 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme1n1p2 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.510 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme2n1 /tmp/make_xfs_jZ5rvfHqzr
2026-01-22 00:05:58.512 + device=/dev/nvme1n1p1
2026-01-22 00:05:58.513 + log_file=/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:58.514 + device=/dev/nvme1n1p2
2026-01-22 00:05:58.515 + log_file=/tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:58.517 + device=/dev/nvme2n1
2026-01-22 00:05:58.518 + log_file=/tmp/make_xfs_jZ5rvfHqzr
2026-01-22 00:05:58.962 + echo 'Waiting for udev to settle'
2026-01-22 00:05:58.964 Waiting for udev to settle
2026-01-22 00:05:58.966 + udevadm settle
2026-01-22 00:05:59.034 + echo 'udevadmn settle finished'
2026-01-22 00:05:59.036 udevadmn settle finished
2026-01-22 00:05:59.037 + process_log_files '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:59.038 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:59.040 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:59.041 + '[' -n '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:59.043 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:59.044 /tmp/make_xfs_jZ5rvfHqzr' ']'
2026-01-22 00:05:59.046 + echo '/tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:59.047 /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:59.048 /tmp/make_xfs_jZ5rvfHqzr'
2026-01-22 00:05:59.050 + read -r log_file
2026-01-22 00:05:59.051 + sed 's#^#    #' /tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:59.052     + mkfs.xfs -f /dev/nvme1n1p1
2026-01-22 00:05:59.054     meta-data=/dev/nvme1n1p1         isize=512    agcount=8, agsize=163840 blks
2026-01-22 00:05:59.056              =                       sectsz=512   attr=2, projid32bit=1
2026-01-22 00:05:59.057              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-22 00:05:59.058              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-22 00:05:59.060              =                       exchange=0  
2026-01-22 00:05:59.061     data     =                       bsize=4096   blocks=1310720, imaxpct=25
2026-01-22 00:05:59.062              =                       sunit=1      swidth=1 blks
2026-01-22 00:05:59.064     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-22 00:05:59.065     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-22 00:05:59.066              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-22 00:05:59.067     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-22 00:05:59.069     
2026-01-22 00:05:59.070     real	0m0.456s
2026-01-22 00:05:59.071     user	0m0.008s
2026-01-22 00:05:59.072     sys	0m0.000s
2026-01-22 00:05:59.074     + exit 0
2026-01-22 00:05:59.075 + rm /tmp/make_xfs_33ZqXg89Pn
2026-01-22 00:05:59.076 + read -r log_file
2026-01-22 00:05:59.077 + sed 's#^#    #' /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:59.078     + mkfs.xfs -f /dev/nvme1n1p2
2026-01-22 00:05:59.080     meta-data=/dev/nvme1n1p2         isize=512    agcount=16, agsize=442352 blks
2026-01-22 00:05:59.081              =                       sectsz=512   attr=2, projid32bit=1
2026-01-22 00:05:59.082              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-22 00:05:59.084              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-22 00:05:59.085              =                       exchange=0  
2026-01-22 00:05:59.086     data     =                       bsize=4096   blocks=7077627, imaxpct=25
2026-01-22 00:05:59.088              =                       sunit=1      swidth=1 blks
2026-01-22 00:05:59.089     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-22 00:05:59.090     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-22 00:05:59.091              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-22 00:05:59.093     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-22 00:05:59.094     
2026-01-22 00:05:59.095     real	0m0.508s
2026-01-22 00:05:59.096     user	0m0.010s
2026-01-22 00:05:59.098     sys	0m0.000s
2026-01-22 00:05:59.099     + exit 0
2026-01-22 00:05:59.101 + rm /tmp/make_xfs_1ajIaNBh9i
2026-01-22 00:05:59.102 + read -r log_file
2026-01-22 00:05:59.103 + sed 's#^#    #' /tmp/make_xfs_jZ5rvfHqzr
2026-01-22 00:05:59.104     + mkfs.xfs -f /dev/nvme2n1
2026-01-22 00:05:59.105     meta-data=/dev/nvme2n1           isize=512    agcount=16, agsize=524288 blks
2026-01-22 00:05:59.107              =                       sectsz=512   attr=2, projid32bit=1
2026-01-22 00:05:59.108              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-22 00:05:59.110              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-22 00:05:59.112              =                       exchange=0  
2026-01-22 00:05:59.113     data     =                       bsize=4096   blocks=8388608, imaxpct=25
2026-01-22 00:05:59.114              =                       sunit=1      swidth=1 blks
2026-01-22 00:05:59.116     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-22 00:05:59.117     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-22 00:05:59.118              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-22 00:05:59.120     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-22 00:05:59.121     
2026-01-22 00:05:59.123     real	0m0.399s
2026-01-22 00:05:59.125     user	0m0.009s
2026-01-22 00:05:59.126     sys	0m0.000s
2026-01-22 00:05:59.127     + exit 0
2026-01-22 00:05:59.129 + rm /tmp/make_xfs_jZ5rvfHqzr
2026-01-22 00:05:59.130 + read -r log_file
2026-01-22 00:05:59.132 + return 0
2026-01-22 00:05:59.134 + emrDevice=/dev/nvme1n1p1
2026-01-22 00:05:59.135 + encrypted_devices=("${encrypted_devices[@]:1}")
2026-01-22 00:05:59.136 + create_devices_mount_map /dev/nvme1n1p1 /emr
2026-01-22 00:05:59.137 + local deviceFile=/dev/nvme1n1p1
2026-01-22 00:05:59.139 + local mount_point=/emr
2026-01-22 00:05:59.140 + echo /dev/nvme1n1p1
2026-01-22 00:05:59.141 + grep -qs /mapper
2026-01-22 00:05:59.143 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme1n1p1' 5
2026-01-22 00:05:59.144 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme1n1p1'
2026-01-22 00:05:59.145 ++ local maxWait=5
2026-01-22 00:05:59.146 ++ local result=
2026-01-22 00:05:59.148 +++ date +%s
2026-01-22 00:05:59.149 ++ endTime=1769040364
2026-01-22 00:05:59.150 ++ '[' -z ']'
2026-01-22 00:05:59.151 +++ date +%s
2026-01-22 00:05:59.153 ++ '[' 1769040359 -lt 1769040364 ']'
2026-01-22 00:05:59.154 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme1n1p1'
2026-01-22 00:05:59.155 ++ result=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.156 ++ '[' -z c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 ']'
2026-01-22 00:05:59.158 ++ printf c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.159 + local deviceUUID=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.160 + '[' -z c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 ']'
2026-01-22 00:05:59.161 + create_drive c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr
2026-01-22 00:05:59.163 + local deviceUUID=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.164 + local drive=/emr
2026-01-22 00:05:59.165 + create_directory /emr
2026-01-22 00:05:59.166 + local dir=/emr
2026-01-22 00:05:59.168 + '[' -d /emr ']'
2026-01-22 00:05:59.169 + '[' -d /emr ']'
2026-01-22 00:05:59.170 + mount_drive c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr
2026-01-22 00:05:59.171 + local deviceUUID=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.172 + local mountPoint=/emr
2026-01-22 00:05:59.174 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-22 00:05:59.175 + grep -
2026-01-22 00:05:59.176 + grep -qs '^c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr$'
2026-01-22 00:05:59.177 + [[ /emr == \/\e\m\r ]]
2026-01-22 00:05:59.179 + mount -o inode64,nodev -t xfs UUID=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr
2026-01-22 00:05:59.180 + remove_fstab_entry c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.181 + local deviceIdentifier=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00
2026-01-22 00:05:59.183 + grep -v c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /etc/fstab
2026-01-22 00:05:59.184 + mv /tmp/fstab /etc/fstab
2026-01-22 00:05:59.187 + echo 'UUID=c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-22 00:05:59.188 + echo 'c90f4a3e-aede-4ef0-bc4e-7094e7ea6d00 /emr'
2026-01-22 00:05:59.189 + mntDevice=/dev/nvme1n1p2
2026-01-22 00:05:59.191 + encrypted_devices=("${encrypted_devices[@]:1}")
2026-01-22 00:05:59.193 + create_devices_mount_map /dev/nvme1n1p2 /mnt
2026-01-22 00:05:59.194 + local deviceFile=/dev/nvme1n1p2
2026-01-22 00:05:59.195 + local mount_point=/mnt
2026-01-22 00:05:59.196 + echo /dev/nvme1n1p2
2026-01-22 00:05:59.197 + grep -qs /mapper
2026-01-22 00:05:59.199 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme1n1p2' 5
2026-01-22 00:05:59.200 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme1n1p2'
2026-01-22 00:05:59.201 ++ local maxWait=5
2026-01-22 00:05:59.203 ++ local result=
2026-01-22 00:05:59.204 +++ date +%s
2026-01-22 00:05:59.206 ++ endTime=1769040364
2026-01-22 00:05:59.207 ++ '[' -z ']'
2026-01-22 00:05:59.208 +++ date +%s
2026-01-22 00:05:59.210 ++ '[' 1769040359 -lt 1769040364 ']'
2026-01-22 00:05:59.211 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme1n1p2'
2026-01-22 00:05:59.212 ++ result=f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.214 ++ '[' -z f32f294f-a453-4b59-bb2e-f6110c720572 ']'
2026-01-22 00:05:59.215 ++ printf f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.217 + local deviceUUID=f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.218 + '[' -z f32f294f-a453-4b59-bb2e-f6110c720572 ']'
2026-01-22 00:05:59.220 + create_drive f32f294f-a453-4b59-bb2e-f6110c720572 /mnt
2026-01-22 00:05:59.221 + local deviceUUID=f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.222 + local drive=/mnt
2026-01-22 00:05:59.224 + create_directory /mnt
2026-01-22 00:05:59.225 + local dir=/mnt
2026-01-22 00:05:59.226 + '[' -d /mnt ']'
2026-01-22 00:05:59.227 + '[' -d /mnt ']'
2026-01-22 00:05:59.229 + mount_drive f32f294f-a453-4b59-bb2e-f6110c720572 /mnt
2026-01-22 00:05:59.230 + local deviceUUID=f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.231 + local mountPoint=/mnt
2026-01-22 00:05:59.232 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-22 00:05:59.234 + grep -
2026-01-22 00:05:59.235 + grep -qs '^f32f294f-a453-4b59-bb2e-f6110c720572 /mnt$'
2026-01-22 00:05:59.236 + [[ /mnt == \/\e\m\r ]]
2026-01-22 00:05:59.238 + mount -o inode64,nodev,usrquota,grpquota,prjquota -t xfs UUID=f32f294f-a453-4b59-bb2e-f6110c720572 /mnt
2026-01-22 00:05:59.239 + remove_fstab_entry f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.240 + local deviceIdentifier=f32f294f-a453-4b59-bb2e-f6110c720572
2026-01-22 00:05:59.241 + grep -v f32f294f-a453-4b59-bb2e-f6110c720572 /etc/fstab
2026-01-22 00:05:59.243 + mv /tmp/fstab /etc/fstab
2026-01-22 00:05:59.244 + echo 'UUID=f32f294f-a453-4b59-bb2e-f6110c720572 /mnt xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-22 00:05:59.245 + echo 'f32f294f-a453-4b59-bb2e-f6110c720572 /mnt'
2026-01-22 00:05:59.247 + deviceIdx=1
2026-01-22 00:05:59.248 + for dev in "${encrypted_devices[@]}"
2026-01-22 00:05:59.249 + create_devices_mount_map /dev/nvme2n1 /mnt1
2026-01-22 00:05:59.250 + local deviceFile=/dev/nvme2n1
2026-01-22 00:05:59.252 + local mount_point=/mnt1
2026-01-22 00:05:59.253 + echo /dev/nvme2n1
2026-01-22 00:05:59.254 + grep -qs /mapper
2026-01-22 00:05:59.255 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme2n1' 5
2026-01-22 00:05:59.257 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme2n1'
2026-01-22 00:05:59.258 ++ local maxWait=5
2026-01-22 00:05:59.259 ++ local result=
2026-01-22 00:05:59.260 +++ date +%s
2026-01-22 00:05:59.262 ++ endTime=1769040364
2026-01-22 00:05:59.263 ++ '[' -z ']'
2026-01-22 00:05:59.264 +++ date +%s
2026-01-22 00:05:59.265 ++ '[' 1769040359 -lt 1769040364 ']'
2026-01-22 00:05:59.267 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme2n1'
2026-01-22 00:05:59.268 ++ result=2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.269 ++ '[' -z 2b9547dd-75cc-4624-85a6-57de16c5a309 ']'
2026-01-22 00:05:59.270 ++ printf 2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.271 + local deviceUUID=2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.274 + '[' -z 2b9547dd-75cc-4624-85a6-57de16c5a309 ']'
2026-01-22 00:05:59.275 + create_drive 2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1
2026-01-22 00:05:59.277 + local deviceUUID=2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.278 + local drive=/mnt1
2026-01-22 00:05:59.279 + create_directory /mnt1
2026-01-22 00:05:59.280 + local dir=/mnt1
2026-01-22 00:05:59.281 + '[' -d /mnt1 ']'
2026-01-22 00:05:59.283 + mkdir -p /mnt1
2026-01-22 00:05:59.284 + '[' -d /mnt1 ']'
2026-01-22 00:05:59.285 + mount_drive 2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1
2026-01-22 00:05:59.286 + local deviceUUID=2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.288 + local mountPoint=/mnt1
2026-01-22 00:05:59.290 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-22 00:05:59.293 + grep -
2026-01-22 00:05:59.295 + grep -qs '^2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1$'
2026-01-22 00:05:59.296 + [[ /mnt1 == \/\e\m\r ]]
2026-01-22 00:05:59.298 + mount -o inode64,nodev,usrquota,grpquota,prjquota -t xfs UUID=2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1
2026-01-22 00:05:59.304 + remove_fstab_entry 2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.305 + local deviceIdentifier=2b9547dd-75cc-4624-85a6-57de16c5a309
2026-01-22 00:05:59.307 + grep -v 2b9547dd-75cc-4624-85a6-57de16c5a309 /etc/fstab
2026-01-22 00:05:59.308 + mv /tmp/fstab /etc/fstab
2026-01-22 00:05:59.309 + echo 'UUID=2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1 xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-22 00:05:59.310 + echo '2b9547dd-75cc-4624-85a6-57de16c5a309 /mnt1'
2026-01-22 00:05:59.315 + (( deviceIdx = deviceIdx + 1 ))
2026-01-22 00:05:59.317 + tee -a /dev/console
2026-01-22 00:05:59.318 ++ date
2026-01-22 00:05:59.320 + echo 'Drives setup completed at: Thu' Jan 22 00:05:59 UTC 2026
2026-01-22 00:05:59.321 Drives setup completed at: Thu Jan 22 00:05:59 UTC 2026
2026-01-22 00:05:59.322 + echo 'Currently mounted devices: '
2026-01-22 00:05:59.323 + tee -a /dev/console
2026-01-22 00:05:59.324 Currently mounted devices: 
2026-01-22 00:05:59.326 + df
2026-01-22 00:05:59.327 + tee -a /dev/console
2026-01-22 00:05:59.328 Filesystem       1K-blocks    Used Available Use% Mounted on
2026-01-22 00:05:59.329 devtmpfs              4096       0      4096   0% /dev
2026-01-22 00:05:59.330 tmpfs              7992888       0   7992888   0% /dev/shm
2026-01-22 00:05:59.332 tmpfs              3197156    8604   3188552   1% /run
2026-01-22 00:05:59.333 /dev/nvme0n1p1    15650796 7156068   8494728  46% /
2026-01-22 00:05:59.334 /dev/nvme0n1p128     10202    1314      8888  13% /boot/efi
2026-01-22 00:05:59.335 /dev/nvme1n1p1     5177344   69368   5107976   2% /emr
2026-01-22 00:05:59.337 /dev/nvme1n1p2    28244972  230756  28014216   1% /mnt
2026-01-22 00:05:59.338 /dev/nvme2n1      33488896  267356  33221540   1% /mnt1
2026-01-22 00:05:59.339 
2026-01-22 00:05:59.340 real	0m8.966s
2026-01-22 00:05:59.341 user	0m3.522s
2026-01-22 00:05:59.343 sys	0m0.219s
