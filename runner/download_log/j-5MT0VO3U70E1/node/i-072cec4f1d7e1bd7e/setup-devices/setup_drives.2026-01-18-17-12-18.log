2026-01-18 17:12:18.407 + setup_drives
2026-01-18 17:12:18.408 + local idx=0
2026-01-18 17:12:18.409 + tee -a /dev/console
2026-01-18 17:12:18.410 ++ date
2026-01-18 17:12:18.411 + echo 'Drives setup started at: Sun' Jan 18 17:12:18 UTC 2026
2026-01-18 17:12:18.412 Drives setup started at: Sun Jan 18 17:12:18 UTC 2026
2026-01-18 17:12:18.413 + set -xe
2026-01-18 17:12:18.414 ++ find /usr/share/aws/emr/instance-controller/lib -name 'instance-controller*.jar' -and -not -name '*interface*'
2026-01-18 17:12:18.428 + local instance_controller_jar=/usr/share/aws/emr/instance-controller/lib/instance-controller-1.85.0.jar
2026-01-18 17:12:18.429 + '[' -e /var/setup-devices/device-names.json ']'
2026-01-18 17:12:18.431 ++ lsblk -pdno NAME
2026-01-18 17:12:18.432 ++ sort -V
2026-01-18 17:12:18.434 + local 'block_devices=/dev/nvme0n1
2026-01-18 17:12:18.435 /dev/nvme1n1
2026-01-18 17:12:18.437 /dev/nvme2n1'
2026-01-18 17:12:18.438 ++ cat /var/setup-devices/device-names.json
2026-01-18 17:12:18.439 ++ jq -r '.symlinkDevices | keys[]'
2026-01-18 17:12:18.440 ++ tr '\n' ' '
2026-01-18 17:12:18.450 + symlink_devices=('/dev/nvme0n1' '/dev/nvme2n1')
2026-01-18 17:12:18.452 + local symlink_devices
2026-01-18 17:12:18.453 ++ jq -r '.deviceNameRegex[]'
2026-01-18 17:12:18.454 ++ paste -s -d '|'
2026-01-18 17:12:18.463 + active_device_pattern='/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-18 17:12:18.465 + for symlink_device in ${symlink_devices[*]}
2026-01-18 17:12:18.466 ++ cat /var/setup-devices/device-names.json
2026-01-18 17:12:18.467 ++ jq -r '.symlinkDevices."/dev/nvme0n1"'
2026-01-18 17:12:18.469 + link_to_device=('/dev/xvda')
2026-01-18 17:12:18.470 + local link_to_device
2026-01-18 17:12:18.471 + symlink_root_device /dev/xvda /dev/nvme0n1
2026-01-18 17:12:18.472 + local root_device=/dev/xvda
2026-01-18 17:12:18.473 + local other_device=/dev/nvme0n1
2026-01-18 17:12:18.475 + '[' '!' -e /dev/xvda ']'
2026-01-18 17:12:18.476 + for symlink_device in ${symlink_devices[*]}
2026-01-18 17:12:18.477 ++ cat /var/setup-devices/device-names.json
2026-01-18 17:12:18.478 ++ jq -r '.symlinkDevices."/dev/nvme0n1"'
2026-01-18 17:12:18.479 + link_to_device=('/dev/xvda')
2026-01-18 17:12:18.480 + local link_to_device
2026-01-18 17:12:18.482 + symlink_root_device /dev/xvda /dev/nvme2n1
2026-01-18 17:12:18.483 + local root_device=/dev/xvda
2026-01-18 17:12:18.484 + local other_device=/dev/nvme2n1
2026-01-18 17:12:18.485 + '[' '!' -e /dev/xvda ']'
2026-01-18 17:12:18.486 + [[ ! -e /var/setup-devices/completed ]]
2026-01-18 17:12:18.488 + setup_cloud_cfg
2026-01-18 17:12:18.489 + cat
2026-01-18 17:12:18.490 + mv /tmp/00_emr.cfg /etc/cloud/cloud.cfg.d/
2026-01-18 17:12:18.491 
2026-01-18 17:12:18.492 real	0m0.005s
2026-01-18 17:12:18.493 user	0m0.002s
2026-01-18 17:12:18.495 sys	0m0.001s
2026-01-18 17:12:18.496 ++ ls /media/
2026-01-18 17:12:18.497 + active_devices=()
2026-01-18 17:12:18.498 + for device in $block_devices
2026-01-18 17:12:18.499 + is_swap_device /dev/nvme0n1
2026-01-18 17:12:18.500 + local device=/dev/nvme0n1
2026-01-18 17:12:18.501 + local return_code=0
2026-01-18 17:12:18.502 + swapon -s
2026-01-18 17:12:18.503 + grep -w /dev/nvme0n1
2026-01-18 17:12:18.504 + return_code=1
2026-01-18 17:12:18.505 + return 1
2026-01-18 17:12:18.507 ++ is_active_device /dev/nvme0n1
2026-01-18 17:12:18.508 ++ local device=/dev/nvme0n1
2026-01-18 17:12:18.509 ++ matches_active_device_pattern /dev/nvme0n1
2026-01-18 17:12:18.510 ++ local device=/dev/nvme0n1
2026-01-18 17:12:18.511 ++ echo /dev/nvme0n1
2026-01-18 17:12:18.512 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-18 17:12:18.514 ++ od -N 0 /dev/nvme0n1
2026-01-18 17:12:18.515 ++ '[' 0 == 0 ']'
2026-01-18 17:12:18.516 ++ echo true
2026-01-18 17:12:18.518 + '[' true '!=' true ']'
2026-01-18 17:12:18.519 ++ is_link_from_root_device /dev/xvda /dev/nvme0n1
2026-01-18 17:12:18.520 +++ readlink -f /dev/xvda
2026-01-18 17:12:18.521 ++ local root_device=/dev/nvme0n1
2026-01-18 17:12:18.522 ++ local this_device=/dev/nvme0n1
2026-01-18 17:12:18.523 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\0\n\1 ]]
2026-01-18 17:12:18.524 ++ echo true
2026-01-18 17:12:18.525 + '[' true == true ']'
2026-01-18 17:12:18.526 + continue
2026-01-18 17:12:18.527 + for device in $block_devices
2026-01-18 17:12:18.528 + is_swap_device /dev/nvme1n1
2026-01-18 17:12:18.529 + local device=/dev/nvme1n1
2026-01-18 17:12:18.530 + local return_code=0
2026-01-18 17:12:18.531 + swapon -s
2026-01-18 17:12:18.532 + grep -w /dev/nvme1n1
2026-01-18 17:12:18.533 + return_code=1
2026-01-18 17:12:18.534 + return 1
2026-01-18 17:12:18.535 ++ is_active_device /dev/nvme1n1
2026-01-18 17:12:18.537 ++ local device=/dev/nvme1n1
2026-01-18 17:12:18.538 ++ matches_active_device_pattern /dev/nvme1n1
2026-01-18 17:12:18.539 ++ local device=/dev/nvme1n1
2026-01-18 17:12:18.540 ++ echo /dev/nvme1n1
2026-01-18 17:12:18.541 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-18 17:12:18.542 ++ od -N 0 /dev/nvme1n1
2026-01-18 17:12:18.543 ++ '[' 0 == 0 ']'
2026-01-18 17:12:18.544 ++ echo true
2026-01-18 17:12:18.545 + '[' true '!=' true ']'
2026-01-18 17:12:18.546 ++ is_link_from_root_device /dev/xvda /dev/nvme1n1
2026-01-18 17:12:18.547 +++ readlink -f /dev/xvda
2026-01-18 17:12:18.548 ++ local root_device=/dev/nvme0n1
2026-01-18 17:12:18.549 ++ local this_device=/dev/nvme1n1
2026-01-18 17:12:18.550 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\1\n\1 ]]
2026-01-18 17:12:18.551 + '[' '' == true ']'
2026-01-18 17:12:18.552 + umount -f /dev/nvme1n1
2026-01-18 17:12:18.554 umount: /dev/nvme1n1: not mounted.
2026-01-18 17:12:18.557 + true
2026-01-18 17:12:18.558 + remove_fstab_entry /dev/nvme1n1
2026-01-18 17:12:18.560 + local deviceIdentifier=/dev/nvme1n1
2026-01-18 17:12:18.561 + grep -v /dev/nvme1n1 /etc/fstab
2026-01-18 17:12:18.562 + mv /tmp/fstab /etc/fstab
2026-01-18 17:12:18.563 + '[' 0 == 0 ']'
2026-01-18 17:12:18.564 + sgdisk -o -n 1:0:+5GB -N2 -p /dev/nvme1n1
2026-01-18 17:12:19.577 Creating new GPT entries in memory.
2026-01-18 17:12:19.579 Disk /dev/nvme1n1: 67108864 sectors, 32.0 GiB
2026-01-18 17:12:19.580 Model: Amazon Elastic Block Store              
2026-01-18 17:12:19.582 Sector size (logical/physical): 512/512 bytes
2026-01-18 17:12:19.583 Disk identifier (GUID): E3E6A8F2-14F7-463A-82AC-9360AF9A92A2
2026-01-18 17:12:19.584 Partition table holds up to 128 entries
2026-01-18 17:12:19.585 Main partition table begins at sector 2 and ends at sector 33
2026-01-18 17:12:19.586 First usable sector is 34, last usable sector is 67108830
2026-01-18 17:12:19.587 Partitions will be aligned on 2048-sector boundaries
2026-01-18 17:12:19.588 Total free space is 2014 sectors (1007.0 KiB)
2026-01-18 17:12:19.590 
2026-01-18 17:12:19.591 Number  Start (sector)    End (sector)  Size       Code  Name
2026-01-18 17:12:19.592    1            2048        10487807   5.0 GiB     8300  
2026-01-18 17:12:19.593    2        10487808        67108830   27.0 GiB    8300  
2026-01-18 17:12:19.594 The operation has completed successfully.
2026-01-18 17:12:19.595 + active_devices=($(ls -1 $device?*))
2026-01-18 17:12:19.596 ++ ls -1 /dev/nvme1n1p1 /dev/nvme1n1p2
2026-01-18 17:12:19.597 + (( idx = idx + 1 ))
2026-01-18 17:12:19.599 + for device in $block_devices
2026-01-18 17:12:19.600 + is_swap_device /dev/nvme2n1
2026-01-18 17:12:19.601 + local device=/dev/nvme2n1
2026-01-18 17:12:19.602 + local return_code=0
2026-01-18 17:12:19.603 + swapon -s
2026-01-18 17:12:19.604 + grep -w /dev/nvme2n1
2026-01-18 17:12:19.605 + return_code=1
2026-01-18 17:12:19.606 + return 1
2026-01-18 17:12:19.607 ++ is_active_device /dev/nvme2n1
2026-01-18 17:12:19.609 ++ local device=/dev/nvme2n1
2026-01-18 17:12:19.610 ++ matches_active_device_pattern /dev/nvme2n1
2026-01-18 17:12:19.611 ++ local device=/dev/nvme2n1
2026-01-18 17:12:19.612 ++ echo /dev/nvme2n1
2026-01-18 17:12:19.613 ++ grep -qE '/dev/xvda2|/dev/nvme[0-9]+n1|/dev/xvd[b-z]+'
2026-01-18 17:12:19.614 ++ od -N 0 /dev/nvme2n1
2026-01-18 17:12:19.615 ++ '[' 0 == 0 ']'
2026-01-18 17:12:19.616 ++ echo true
2026-01-18 17:12:19.617 + '[' true '!=' true ']'
2026-01-18 17:12:19.618 ++ is_link_from_root_device /dev/xvda /dev/nvme2n1
2026-01-18 17:12:19.619 +++ readlink -f /dev/xvda
2026-01-18 17:12:19.620 ++ local root_device=/dev/nvme0n1
2026-01-18 17:12:19.621 ++ local this_device=/dev/nvme2n1
2026-01-18 17:12:19.623 ++ [[ /dev/nvme0n1 == \/\d\e\v\/\n\v\m\e\2\n\1 ]]
2026-01-18 17:12:19.624 + '[' '' == true ']'
2026-01-18 17:12:19.625 + umount -f /dev/nvme2n1
2026-01-18 17:12:19.626 umount: /dev/nvme2n1: not mounted.
2026-01-18 17:12:19.627 + true
2026-01-18 17:12:19.628 + remove_fstab_entry /dev/nvme2n1
2026-01-18 17:12:19.629 + local deviceIdentifier=/dev/nvme2n1
2026-01-18 17:12:19.630 + grep -v /dev/nvme2n1 /etc/fstab
2026-01-18 17:12:19.632 + mv /tmp/fstab /etc/fstab
2026-01-18 17:12:19.633 + '[' 1 == 0 ']'
2026-01-18 17:12:19.634 + active_devices+=($device)
2026-01-18 17:12:19.635 + (( idx = idx + 1 ))
2026-01-18 17:12:19.637 + encrypted_devices=($($INSTANCE_CONTROLLER_JAVA/java -cp $DISK_ENCRYPTOR_CP -Dlog4j2.configurationFile=file:$DISK_ENCRYPTOR_LOG4J2_CONFIG -Dlog4j2.formatMsgNoLookups=true -Dlog4j2.disable.jmx=true aws157.instancecontroller.encryptor.DiskEncryptorMain ${active_devices[*]}))
2026-01-18 17:12:19.638 ++ /usr/lib/jvm/jre-17/bin/java -cp '/usr/share/aws/emr/instance-controller/lib/*:/var/setup-devices/lib/*:/home/hadoop/conf:/usr/share/aws/aws-java-sdk-v2/*' -Dlog4j2.configurationFile=file:/etc/instance-controller/disk-encryptor-log4j2.xml -Dlog4j2.formatMsgNoLookups=true -Dlog4j2.disable.jmx=true aws157.instancecontroller.encryptor.DiskEncryptorMain /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-18 17:12:24.927 SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
2026-01-18 17:12:24.929 SLF4J: Defaulting to no-operation (NOP) logger implementation
2026-01-18 17:12:24.930 SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
2026-01-18 17:12:25.427 + make_xfs_parallel /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-18 17:12:25.428 ++ printf '%s\n' /dev/nvme1n1p1 /dev/nvme1n1p2 /dev/nvme2n1
2026-01-18 17:12:25.429 + local 'devices=/dev/nvme1n1p1
2026-01-18 17:12:25.430 /dev/nvme1n1p2
2026-01-18 17:12:25.432 /dev/nvme2n1'
2026-01-18 17:12:25.433 ++ run_repeatedly 3 mktemp -t make_xfs_XXXXXXXXXX
2026-01-18 17:12:25.434 ++ (( i = 0 ))
2026-01-18 17:12:25.436 ++ (( i < 3 ))
2026-01-18 17:12:25.437 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-18 17:12:25.438 ++ (( i++ ))
2026-01-18 17:12:25.439 ++ (( i < 3 ))
2026-01-18 17:12:25.441 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-18 17:12:25.442 ++ (( i++ ))
2026-01-18 17:12:25.443 ++ (( i < 3 ))
2026-01-18 17:12:25.444 ++ mktemp -t make_xfs_XXXXXXXXXX
2026-01-18 17:12:25.445 ++ (( i++ ))
2026-01-18 17:12:25.446 ++ (( i < 3 ))
2026-01-18 17:12:25.447 + local 'log_files=/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.448 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.449 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:25.450 + local return_code=0
2026-01-18 17:12:25.451 + run_make_xfs_parallel '/dev/nvme1n1p1
2026-01-18 17:12:25.452 /dev/nvme1n1p2
2026-01-18 17:12:25.454 /dev/nvme2n1' '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.455 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.456 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:25.457 + timeout --kill-after=10 10 bash -c '{ date; udevadm monitor; }'
2026-01-18 17:12:25.458 + local 'devices=/dev/nvme1n1p1
2026-01-18 17:12:25.459 /dev/nvme1n1p2
2026-01-18 17:12:25.460 /dev/nvme2n1'
2026-01-18 17:12:25.461 + local 'log_files=/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.463 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.464 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:25.465 + interleave_lines '/dev/nvme1n1p1
2026-01-18 17:12:25.466 /dev/nvme1n1p2
2026-01-18 17:12:25.467 /dev/nvme2n1' '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.468 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.469 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:25.470 ++ date +%Y-%m-%d-%H-%M-%S
2026-01-18 17:12:25.471 + xargs -r --verbose -P0 -L2 bash -xc '
2026-01-18 17:12:25.472       device=$0; log_file=$1
2026-01-18 17:12:25.473       { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1'
2026-01-18 17:12:25.474 + paste '-d\n' /dev/fd/63 /dev/fd/62
2026-01-18 17:12:25.475 ++ echo '/dev/nvme1n1p1
2026-01-18 17:12:25.476 /dev/nvme1n1p2
2026-01-18 17:12:25.477 /dev/nvme2n1'
2026-01-18 17:12:25.478 ++ echo '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.480 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.481 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:25.482 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme1n1p1 /tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.483 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme1n1p2 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.484 bash -xc ''$'\n''      device=$0; log_file=$1'$'\n''      { time mkfs.xfs -f "$device"; exit $?; } > "$log_file" 2>&1' /dev/nvme2n1 /tmp/make_xfs_2GynxHTpas
2026-01-18 17:12:25.485 + device=/dev/nvme1n1p1
2026-01-18 17:12:25.486 + log_file=/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:25.487 + device=/dev/nvme1n1p2
2026-01-18 17:12:25.488 + log_file=/tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:25.489 + device=/dev/nvme2n1
2026-01-18 17:12:25.490 + log_file=/tmp/make_xfs_2GynxHTpas
2026-01-18 17:12:25.904 + echo 'Waiting for udev to settle'
2026-01-18 17:12:25.906 Waiting for udev to settle
2026-01-18 17:12:25.907 + udevadm settle
2026-01-18 17:12:25.997 + echo 'udevadmn settle finished'
2026-01-18 17:12:25.999 udevadmn settle finished
2026-01-18 17:12:26.000 + process_log_files '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:26.001 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:26.002 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:26.003 + '[' -n '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:26.004 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:26.006 /tmp/make_xfs_2GynxHTpas' ']'
2026-01-18 17:12:26.007 + echo '/tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:26.008 /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:26.009 /tmp/make_xfs_2GynxHTpas'
2026-01-18 17:12:26.010 + read -r log_file
2026-01-18 17:12:26.011 + sed 's#^#    #' /tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:26.012     + mkfs.xfs -f /dev/nvme1n1p1
2026-01-18 17:12:26.013     meta-data=/dev/nvme1n1p1         isize=512    agcount=8, agsize=163840 blks
2026-01-18 17:12:26.015              =                       sectsz=512   attr=2, projid32bit=1
2026-01-18 17:12:26.016              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-18 17:12:26.017              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-18 17:12:26.018              =                       exchange=0  
2026-01-18 17:12:26.019     data     =                       bsize=4096   blocks=1310720, imaxpct=25
2026-01-18 17:12:26.020              =                       sunit=1      swidth=1 blks
2026-01-18 17:12:26.021     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-18 17:12:26.023     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-18 17:12:26.024              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-18 17:12:26.025     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-18 17:12:26.026     
2026-01-18 17:12:26.027     real	0m0.361s
2026-01-18 17:12:26.028     user	0m0.000s
2026-01-18 17:12:26.029     sys	0m0.007s
2026-01-18 17:12:26.030     + exit 0
2026-01-18 17:12:26.031 + rm /tmp/make_xfs_twzyT4WWHM
2026-01-18 17:12:26.032 + read -r log_file
2026-01-18 17:12:26.033 + sed 's#^#    #' /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:26.034     + mkfs.xfs -f /dev/nvme1n1p2
2026-01-18 17:12:26.035     meta-data=/dev/nvme1n1p2         isize=512    agcount=16, agsize=442352 blks
2026-01-18 17:12:26.036              =                       sectsz=512   attr=2, projid32bit=1
2026-01-18 17:12:26.037              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-18 17:12:26.038              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-18 17:12:26.039              =                       exchange=0  
2026-01-18 17:12:26.040     data     =                       bsize=4096   blocks=7077627, imaxpct=25
2026-01-18 17:12:26.041              =                       sunit=1      swidth=1 blks
2026-01-18 17:12:26.042     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-18 17:12:26.044     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-18 17:12:26.045              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-18 17:12:26.046     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-18 17:12:26.047     
2026-01-18 17:12:26.048     real	0m0.467s
2026-01-18 17:12:26.049     user	0m0.000s
2026-01-18 17:12:26.050     sys	0m0.008s
2026-01-18 17:12:26.051     + exit 0
2026-01-18 17:12:26.052 + rm /tmp/make_xfs_7Vsb8kCG0X
2026-01-18 17:12:26.053 + read -r log_file
2026-01-18 17:12:26.054 + sed 's#^#    #' /tmp/make_xfs_2GynxHTpas
2026-01-18 17:12:26.055     + mkfs.xfs -f /dev/nvme2n1
2026-01-18 17:12:26.056     meta-data=/dev/nvme2n1           isize=512    agcount=16, agsize=524288 blks
2026-01-18 17:12:26.057              =                       sectsz=512   attr=2, projid32bit=1
2026-01-18 17:12:26.058              =                       crc=1        finobt=1, sparse=1, rmapbt=0
2026-01-18 17:12:26.059              =                       reflink=1    bigtime=1 inobtcount=1 nrext64=0
2026-01-18 17:12:26.060              =                       exchange=0  
2026-01-18 17:12:26.061     data     =                       bsize=4096   blocks=8388608, imaxpct=25
2026-01-18 17:12:26.062              =                       sunit=1      swidth=1 blks
2026-01-18 17:12:26.063     naming   =version 2              bsize=4096   ascii-ci=0, ftype=1, parent=0
2026-01-18 17:12:26.064     log      =internal log           bsize=4096   blocks=16384, version=2
2026-01-18 17:12:26.065              =                       sectsz=512   sunit=1 blks, lazy-count=1
2026-01-18 17:12:26.066     realtime =none                   extsz=4096   blocks=0, rtextents=0
2026-01-18 17:12:26.068     
2026-01-18 17:12:26.069     real	0m0.401s
2026-01-18 17:12:26.070     user	0m0.008s
2026-01-18 17:12:26.071     sys	0m0.000s
2026-01-18 17:12:26.072     + exit 0
2026-01-18 17:12:26.073 + rm /tmp/make_xfs_2GynxHTpas
2026-01-18 17:12:26.074 + read -r log_file
2026-01-18 17:12:26.075 + return 0
2026-01-18 17:12:26.077 + emrDevice=/dev/nvme1n1p1
2026-01-18 17:12:26.078 + encrypted_devices=("${encrypted_devices[@]:1}")
2026-01-18 17:12:26.079 + create_devices_mount_map /dev/nvme1n1p1 /emr
2026-01-18 17:12:26.080 + local deviceFile=/dev/nvme1n1p1
2026-01-18 17:12:26.081 + local mount_point=/emr
2026-01-18 17:12:26.082 + echo /dev/nvme1n1p1
2026-01-18 17:12:26.083 + grep -qs /mapper
2026-01-18 17:12:26.084 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme1n1p1' 5
2026-01-18 17:12:26.086 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme1n1p1'
2026-01-18 17:12:26.087 ++ local maxWait=5
2026-01-18 17:12:26.088 ++ local result=
2026-01-18 17:12:26.089 +++ date +%s
2026-01-18 17:12:26.090 ++ endTime=1768756351
2026-01-18 17:12:26.091 ++ '[' -z ']'
2026-01-18 17:12:26.093 +++ date +%s
2026-01-18 17:12:26.094 ++ '[' 1768756346 -lt 1768756351 ']'
2026-01-18 17:12:26.095 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme1n1p1'
2026-01-18 17:12:26.096 ++ result=fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.097 ++ '[' -z fa1acb75-84c4-4a42-86ee-b27d2a407d36 ']'
2026-01-18 17:12:26.098 ++ printf fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.099 + local deviceUUID=fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.100 + '[' -z fa1acb75-84c4-4a42-86ee-b27d2a407d36 ']'
2026-01-18 17:12:26.101 + create_drive fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr
2026-01-18 17:12:26.102 + local deviceUUID=fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.103 + local drive=/emr
2026-01-18 17:12:26.104 + create_directory /emr
2026-01-18 17:12:26.105 + local dir=/emr
2026-01-18 17:12:26.106 + '[' -d /emr ']'
2026-01-18 17:12:26.107 + '[' -d /emr ']'
2026-01-18 17:12:26.108 + mount_drive fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr
2026-01-18 17:12:26.109 + local deviceUUID=fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.110 + local mountPoint=/emr
2026-01-18 17:12:26.111 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-18 17:12:26.112 + grep -
2026-01-18 17:12:26.113 + grep -qs '^fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr$'
2026-01-18 17:12:26.115 + [[ /emr == \/\e\m\r ]]
2026-01-18 17:12:26.116 + mount -o inode64,nodev -t xfs UUID=fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr
2026-01-18 17:12:26.117 + remove_fstab_entry fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.118 + local deviceIdentifier=fa1acb75-84c4-4a42-86ee-b27d2a407d36
2026-01-18 17:12:26.119 + grep -v fa1acb75-84c4-4a42-86ee-b27d2a407d36 /etc/fstab
2026-01-18 17:12:26.120 + mv /tmp/fstab /etc/fstab
2026-01-18 17:12:26.121 + echo 'UUID=fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-18 17:12:26.122 + echo 'fa1acb75-84c4-4a42-86ee-b27d2a407d36 /emr'
2026-01-18 17:12:26.123 + mntDevice=/dev/nvme1n1p2
2026-01-18 17:12:26.124 + encrypted_devices=("${encrypted_devices[@]:1}")
2026-01-18 17:12:26.125 + create_devices_mount_map /dev/nvme1n1p2 /mnt
2026-01-18 17:12:26.126 + local deviceFile=/dev/nvme1n1p2
2026-01-18 17:12:26.128 + local mount_point=/mnt
2026-01-18 17:12:26.129 + echo /dev/nvme1n1p2
2026-01-18 17:12:26.130 + grep -qs /mapper
2026-01-18 17:12:26.131 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme1n1p2' 5
2026-01-18 17:12:26.132 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme1n1p2'
2026-01-18 17:12:26.133 ++ local maxWait=5
2026-01-18 17:12:26.134 ++ local result=
2026-01-18 17:12:26.135 +++ date +%s
2026-01-18 17:12:26.136 ++ endTime=1768756351
2026-01-18 17:12:26.137 ++ '[' -z ']'
2026-01-18 17:12:26.138 +++ date +%s
2026-01-18 17:12:26.139 ++ '[' 1768756346 -lt 1768756351 ']'
2026-01-18 17:12:26.140 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme1n1p2'
2026-01-18 17:12:26.141 ++ result=95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.143 ++ '[' -z 95bf949e-c6c0-4ce5-9766-0967c555d0cc ']'
2026-01-18 17:12:26.144 ++ printf 95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.145 + local deviceUUID=95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.146 + '[' -z 95bf949e-c6c0-4ce5-9766-0967c555d0cc ']'
2026-01-18 17:12:26.147 + create_drive 95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt
2026-01-18 17:12:26.148 + local deviceUUID=95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.149 + local drive=/mnt
2026-01-18 17:12:26.150 + create_directory /mnt
2026-01-18 17:12:26.151 + local dir=/mnt
2026-01-18 17:12:26.152 + '[' -d /mnt ']'
2026-01-18 17:12:26.153 + '[' -d /mnt ']'
2026-01-18 17:12:26.154 + mount_drive 95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt
2026-01-18 17:12:26.156 + local deviceUUID=95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.157 + local mountPoint=/mnt
2026-01-18 17:12:26.158 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-18 17:12:26.159 + grep -
2026-01-18 17:12:26.160 + grep -qs '^95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt$'
2026-01-18 17:12:26.161 + [[ /mnt == \/\e\m\r ]]
2026-01-18 17:12:26.163 + mount -o inode64,nodev,usrquota,grpquota,prjquota -t xfs UUID=95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt
2026-01-18 17:12:26.164 + remove_fstab_entry 95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.165 + local deviceIdentifier=95bf949e-c6c0-4ce5-9766-0967c555d0cc
2026-01-18 17:12:26.166 + grep -v 95bf949e-c6c0-4ce5-9766-0967c555d0cc /etc/fstab
2026-01-18 17:12:26.167 + mv /tmp/fstab /etc/fstab
2026-01-18 17:12:26.169 + echo 'UUID=95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-18 17:12:26.170 + echo '95bf949e-c6c0-4ce5-9766-0967c555d0cc /mnt'
2026-01-18 17:12:26.171 + deviceIdx=1
2026-01-18 17:12:26.172 + for dev in "${encrypted_devices[@]}"
2026-01-18 17:12:26.173 + create_devices_mount_map /dev/nvme2n1 /mnt1
2026-01-18 17:12:26.174 + local deviceFile=/dev/nvme2n1
2026-01-18 17:12:26.175 + local mount_point=/mnt1
2026-01-18 17:12:26.176 + echo /dev/nvme2n1
2026-01-18 17:12:26.177 + grep -qs /mapper
2026-01-18 17:12:26.178 ++ repeat_command_until_not_empty 'lsblk -o UUID -ipnd /dev/nvme2n1' 5
2026-01-18 17:12:26.179 ++ local 'cmd=lsblk -o UUID -ipnd /dev/nvme2n1'
2026-01-18 17:12:26.180 ++ local maxWait=5
2026-01-18 17:12:26.181 ++ local result=
2026-01-18 17:12:26.182 +++ date +%s
2026-01-18 17:12:26.183 ++ endTime=1768756351
2026-01-18 17:12:26.184 ++ '[' -z ']'
2026-01-18 17:12:26.185 +++ date +%s
2026-01-18 17:12:26.186 ++ '[' 1768756346 -lt 1768756351 ']'
2026-01-18 17:12:26.187 +++ bash -c 'lsblk -o UUID -ipnd /dev/nvme2n1'
2026-01-18 17:12:26.188 ++ result=77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.189 ++ '[' -z 77a748c1-473a-4cd6-aad7-55317326e074 ']'
2026-01-18 17:12:26.190 ++ printf 77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.191 + local deviceUUID=77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.193 + '[' -z 77a748c1-473a-4cd6-aad7-55317326e074 ']'
2026-01-18 17:12:26.194 + create_drive 77a748c1-473a-4cd6-aad7-55317326e074 /mnt1
2026-01-18 17:12:26.195 + local deviceUUID=77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.196 + local drive=/mnt1
2026-01-18 17:12:26.197 + create_directory /mnt1
2026-01-18 17:12:26.198 + local dir=/mnt1
2026-01-18 17:12:26.199 + '[' -d /mnt1 ']'
2026-01-18 17:12:26.200 + mkdir -p /mnt1
2026-01-18 17:12:26.201 + '[' -d /mnt1 ']'
2026-01-18 17:12:26.202 + mount_drive 77a748c1-473a-4cd6-aad7-55317326e074 /mnt1
2026-01-18 17:12:26.203 + local deviceUUID=77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.204 + local mountPoint=/mnt1
2026-01-18 17:12:26.205 + lsblk -o UUID,MOUNTPOINT -ipnr
2026-01-18 17:12:26.206 + grep -
2026-01-18 17:12:26.207 + grep -qs '^77a748c1-473a-4cd6-aad7-55317326e074 /mnt1$'
2026-01-18 17:12:26.208 + [[ /mnt1 == \/\e\m\r ]]
2026-01-18 17:12:26.209 + mount -o inode64,nodev,usrquota,grpquota,prjquota -t xfs UUID=77a748c1-473a-4cd6-aad7-55317326e074 /mnt1
2026-01-18 17:12:26.233 + remove_fstab_entry 77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.234 + local deviceIdentifier=77a748c1-473a-4cd6-aad7-55317326e074
2026-01-18 17:12:26.236 + grep -v 77a748c1-473a-4cd6-aad7-55317326e074 /etc/fstab
2026-01-18 17:12:26.237 + mv /tmp/fstab /etc/fstab
2026-01-18 17:12:26.239 + echo 'UUID=77a748c1-473a-4cd6-aad7-55317326e074 /mnt1 xfs defaults,noauto,comment=emr-setup-devices 0 0'
2026-01-18 17:12:26.240 + echo '77a748c1-473a-4cd6-aad7-55317326e074 /mnt1'
2026-01-18 17:12:26.241 + (( deviceIdx = deviceIdx + 1 ))
2026-01-18 17:12:26.242 + tee -a /dev/console
2026-01-18 17:12:26.244 ++ date
2026-01-18 17:12:26.246 + echo 'Drives setup completed at: Sun' Jan 18 17:12:26 UTC 2026
2026-01-18 17:12:26.247 Drives setup completed at: Sun Jan 18 17:12:26 UTC 2026
2026-01-18 17:12:26.248 + echo 'Currently mounted devices: '
2026-01-18 17:12:26.249 + tee -a /dev/console
2026-01-18 17:12:26.250 Currently mounted devices: 
2026-01-18 17:12:26.251 + df
2026-01-18 17:12:26.252 + tee -a /dev/console
2026-01-18 17:12:26.253 Filesystem       1K-blocks    Used Available Use% Mounted on
2026-01-18 17:12:26.254 devtmpfs              4096       0      4096   0% /dev
2026-01-18 17:12:26.255 tmpfs              8078908       0   8078908   0% /dev/shm
2026-01-18 17:12:26.256 tmpfs              3231564    8604   3222960   1% /run
2026-01-18 17:12:26.261 /dev/nvme0n1p1    15650796 7156064   8494732  46% /
2026-01-18 17:12:26.262 /dev/nvme0n1p128     10202    1314      8888  13% /boot/efi
2026-01-18 17:12:26.263 /dev/nvme1n1p1     5177344   69368   5107976   2% /emr
2026-01-18 17:12:26.264 /dev/nvme1n1p2    28244972  230756  28014216   1% /mnt
2026-01-18 17:12:26.265 /dev/nvme2n1      33488896  267356  33221540   1% /mnt1
2026-01-18 17:12:26.274 
2026-01-18 17:12:26.275 real	0m7.868s
2026-01-18 17:12:26.276 user	0m2.685s
2026-01-18 17:12:26.277 sys	0m0.301s
